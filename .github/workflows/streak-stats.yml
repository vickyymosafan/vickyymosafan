name: Generate GitHub Metrics & Streak Stats

on:
  # Run every 12 hours
  schedule:
    - cron: "0 */12 * * *"

  # Allow manual trigger
  workflow_dispatch:

  # Trigger on push to main
  push:
    branches:
      - main

# Prevent duplicate runs
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  generate:
    name: Generate Metrics
    runs-on: ubuntu-latest
    timeout-minutes: 10

    permissions:
      contents: write

    environment:
      name: github-metrics
      url: https://github.com/${{ github.repository }}/tree/output

    steps:
      # Generate Isometric Calendar with Streak Stats
      - name: Generate Streak Stats (Isometric Calendar)
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: github-streak.svg
          
          # Output configuration
          output_action: commit
          committer_branch: output
          committer_message: "chore: update github streak stats [skip ci]"
          
          # User configuration
          user: vickyymosafan
          
          # Base configuration - minimal for streak focus
          base: ""
          
          # Isometric Calendar Plugin (shows streak)
          plugin_isocalendar: yes
          plugin_isocalendar_duration: half-year
          
          # Timezone
          config_timezone: Asia/Jakarta
          
          # Theme - Tokyo Night compatible colors
          config_display: large
          config_padding: 5%

      # Generate Full Stats Overview
      - name: Generate Full Profile Stats
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          filename: github-stats.svg
          
          output_action: commit
          committer_branch: output
          committer_message: "chore: update github stats [skip ci]"
          
          user: vickyymosafan
          
          # Enable comprehensive stats
          base: header, activity, community, repositories
          base_indepth: yes
          
          # Contributions calendar
          plugin_calendar: yes
          plugin_calendar_limit: 1
          
          # Languages
          plugin_languages: yes
          plugin_languages_sections: most-used
          plugin_languages_limit: 8
          
          # Habits
          plugin_habits: yes
          plugin_habits_days: 14
          plugin_habits_facts: yes
          plugin_habits_charts: yes
          
          # Achievements
          plugin_achievements: yes
          plugin_achievements_display: compact
          plugin_achievements_threshold: B
          
          config_timezone: Asia/Jakarta
          config_display: large
